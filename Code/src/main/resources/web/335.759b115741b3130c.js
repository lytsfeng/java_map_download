"use strict";(self.webpackChunkWeb=self.webpackChunkWeb||[]).push([[335],{335:(m,h,s)=>{s.r(h),s.d(h,{IndexModule:()=>v});var l=s(6895),a=s(3356),c=s(9132);class d{constructor(n){if(this.lockReconnect=!1,this.isClosingWindow=!1,null===n.url||""===n.url)throw"url\u4e0d\u80fd\u4e3a\u7a7a";this.opt=n,this.initWebSocket()}initWebSocket(){this.ws=null==this.opt.secWebSocketProtocol||0==this.opt.secWebSocketProtocol.length?new WebSocket(this.opt.url):new WebSocket(this.opt.url,this.opt.secWebSocketProtocol),this.initEventHandle(),window.onbeforeunload=()=>{this.isClosingWindow=!0,this.ws.close()}}initEventHandle(){this.ws.onclose=()=>{console.log("ws\u8fde\u63a5\u5173\u95ed!"+this.opt.url),this.opt.onclose&&this.opt.onclose(),this.heartCheckStop(),this.isClosingWindow||this.reconnect()},this.ws.onerror=()=>{console.log("ws\u8fde\u63a5\u9519\u8bef!"+this.opt.url),this.opt.onerror&&this.opt.onerror(),this.heartCheckStop(),this.isClosingWindow||this.reconnect()},this.ws.onopen=()=>{console.log("ws\u8fde\u63a5\u6210\u529f!"+this.opt.url),this.opt.onopen&&this.opt.onopen(),this.heartCheckStart()},this.ws.onmessage=n=>{this.opt.onmessage&&this.opt.onmessage(n)}}reconnect(){this.lockReconnect||(this.lockReconnect=!0,this.reconnectTimeout=setTimeout(()=>{this.initWebSocket(),this.lockReconnect=!1},2e3))}reconnectStop(){clearTimeout(this.reconnectTimeout)}heartCheckStart(){this.ws.send("heartCheck"),this.heartSendInterval=setInterval(()=>{this.ws.send("heartCheck")},3e5)}heartCheckStop(){clearInterval(this.heartSendInterval)}close(){this.reconnectStop(),this.heartCheckStop(),this.isClosingWindow=!0,this.ws.close()}}class u{constructor(n,e){this.path=n,this.innerMqService=e,this.connection()}connection(){this.ws=new d({url:this.path,onopen:()=>{},onerror:()=>{},onmessage:e=>{if(e.data&&""!==e.data){let i=JSON.parse(e.data);this.innerMqService.pub(i.title,i.content)}}})}disConnection(){this.ws.close()}}var p=s(185),o=s(4650),f=s(2720);let r=(()=>{class t{constructor(e){this.http=e}getWsPath(){return this.http.request({method:p.w.GET,url:"/info/getWsPath",data:null})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(f.Y))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})();var S=s(8138);const g=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"",component:(()=>{class t{constructor(e,i){this.innerMqService=e,this.infoService=i}ngOnInit(){this.infoService.getWsPath().then(e=>{this.websocket=new u(e.data,this.innerMqService)})}ngOnDestroy(){this.websocket.disConnection()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(S.X),o.Y36(r))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-index"]],features:[o._Bn([r])],decls:2,vars:0,consts:[[1,"container"]],template:function(e,i){1&e&&(o.TgZ(0,"div",0),o._UZ(1,"router-outlet"),o.qZA())},dependencies:[c.lC],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh}"]}),t})(),children:[{path:"map",loadChildren:()=>s.e(321).then(s.bind(s,6321)).then(t=>t.MapModule)}]}];let w=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[c.Bz.forChild(g),c.Bz]}),t})(),v=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[l.ez,w,a.b]}),t})()}}]);